# 您应该从 TFVC 迁移到 Git 的 4 个不太明显的原因

> 原文:# t0]https://simple programmer . com/git-vs-tfvc/

![](img/c4ac8e4e9e08db9932ad538256b5bd87.png)

The Team Foundation Server (TFS) is a Microsoft product that provides all the necessary features to support the software development process, like source code management, requirements and project management, and build and release processes.

如今，TFS 支持两种类型的源代码管理系统:Team Foundation 版本控制(TFVC)和 Git。

从表面上看，这两个系统非常相似。您可以提交您的代码更改，可以查看谁更改了什么的历史记录，并且可以恢复到您的源代码的先前状态。

然而，通过更深入的观察，你会发现系统设计中的一些关键差异——最明显的是，TFVC 提供了一个集中的存储库，而 Git 建立在一个分散的模型上。

如今，几乎所有新开始的软件项目都使用 Git 进行源代码管理。甚至[微软说](https://docs.microsoft.com/en-us/vsts/repos/tfvc/comparison-git-tfvc?view=vsts)你应该使用 Git 进行版本控制，除非你对 TFVC 的集中版本控制特性有特别的需求。因此，Git 也是 TFS 新项目的默认选项。

最初，TFS 只支持 TFVC，后来在 [TFS 2013](https://blogs.msdn.microsoft.com/mvpawardprogram/2013/11/13/git-for-tfs-2013/) 中增加了对 Git 作为源代码库的支持。

我确信在 Git 支持可用之前，有很多软件项目是用 TFS 开发的。因此，这些项目不得不选择 TFVC 作为源代码管理系统。由于没有人将它们迁移到 Git，这些项目从那时起就一直困在 TFVC。

例如，在我的公司里，我们至少有六个正在使用 TFVC 的软件项目。很长一段时间，我们没有看到将它们迁移到 Git 的必要性。

如果您习惯于 TFVC，并且从未真正使用过 Git，那么您不会知道这些微小但至关重要的区别。

当你使用 Git 代替 TFVC 作为源代码库时，有很多好处。在这篇文章中，我会给你四个不那么明显的理由来解释为什么这些项目应该从 TFVC 迁移到 Git。

## 与 TFVC 相比，使用 Git 的优势

### 1.Git 支持对同一特性的联合工作

假设您想要实现一个新特性，它需要数据库中的一个新表、后端服务中的一些更改以及前端的一些新页面。只有完成了所有这些更改，新功能才算完整，可以投入生产。

这些任务需要不同的技能组合—一些数据库知识、后端开发人员的经验和一些前端技能。通常，这些技能不是一个人所拥有的，因此需要由多个人共同努力才能完成。

这意味着多人同时处理同一个特性，并且必须在某个时候共享他们的工作。所以每个人都有一块拼图，只有你把它们放在一起，你的特征才会完整。

**与 TFVC 分享工作**

如果团队使用 TFVC，那么轻松地共享未完成的工作是相当棘手的。然而，有一种方法可以创建一个所谓的“搁置集”并与另一个开发人员共享。

搁置集只是您的代码的一个特定版本，它尚未提交到分支，但可以与其他开发人员共享。但是，如果您与团队成员共享一个搁置集，他们将无法基于该搁置集继续工作。他们可以查看它，但是不能将他们的工作与它集成。这在 TFVC 是不可能的。

通常的解决方法是将您未完成的工作提交到一个分支——我们称之为“开发”分支。现在，你的队友，谁是工作在同一功能，可以获取它，并与你的集成他们的作品。

在这种情况下，您的提交将很可能包含不完整的并且可能未经测试的代码，因为只有当特性的其他部分已经开发出来时，才能执行测试。

这不是一个好的位置——特别是对于你团队中的其他开发人员，他们正在开发一个完全不同的特性。他们还会获取你不完整和未测试的代码，因此可能会经历软件的一些不良行为——即使他们正在处理一个完全不同的特性。

**与 Git 共享工作**

![](img/d7638a82960e7865c59cb470331701a3.png)

In contrast, teams working with Git usually use some version of the [feature branch model](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow). For each feature, you create a separate branch and share that branch only with other developers who are also working on that same feature. Each developer commits to that feature branch, adding their part of the changes necessary to complete the feature.

只有当每个人都添加了他们的工作，并且功能被测试和完成时，整个功能才会被合并到开发分支。所以你的开发分支永远不会包含未测试的或者不完整的代码。

因此，当多个开发人员在同一个特性上一起工作时，在使用 TFVC 时共享不完整的工作是非常复杂的，但是在使用 Git 时却很简单。

### 2.Git 允许您更新现有的拉请求

代码审查是开发过程中非常重要的一步，因为它们确保了更好的代码质量，也造就了更好的团队。

在[种不同类型的](https://www.scrum-tips.com/2018/05/13/types-of-code-reviews/)代码评审中，很多开发团队默认使用异步类型。Git 和 TFVC 都支持这一审查过程。

在 Git 的世界里，人们使用所谓的“拉请求”来请求对代码变更的反馈。

TFVC 支持“审查请求”，这在某种程度上类似于 Git 中的拉请求。

两者都有相同的目的，那就是与另一个开发人员共享代码变更，这样他们就可以检查代码并给出改进的反馈。

然而，审查请求和拉请求之间有一个非常关键的区别，这对流程有非常大的影响。让我解释一下。

**更新 TFVC 的审核请求**

在 TFVC，从事编码工作的开发人员——或者编码人员——可以将尚未提交到分支的代码变更发送给评审人员。本质上，编码者与评审者共享一个搁置集。

然后，评审者可以提出意见来改进代码，并将评审标记为“需要工作”之后，编码人员进行必要的修改，并创建另一个评审请求。

这里最大的缺点是第二个评审请求与第一个没有任何联系。这意味着评审者必须评审*所有的*变更，而不仅仅是最后的改进。因此，对于每一个改进，评审者都会得到一个新的评审请求，并且不得不再次评审全部内容。

**更新 Git 中的拉取请求**

相比之下，在 Git 中，*可以将*改进更改添加到*现有的 pull* 请求中。

当您必须根据来自评审者的反馈进行改进时，您将这些更改再次提交到同一个分支。然后，这些变更在同一个拉请求中结束，评审者只需要评审那些最后的改进。

当使用 Git 时，这个事实使得整个代码评审过程变得简单了很多，特别是当编码者是一个初级人员并且评审者有很多改进 pull 请求的建议时。

在这种情况下，您将有多个代码审查周期，直到拉请求足够好并且审查者满意为止。在每一个循环中，编码者改变现有的拉请求，而评审者只需要评审这些改变，而不是从头开始评审所有的东西。

因此，与 TFVC 中的审查请求不同，Git 中的拉请求支持多次提交。如果更改了现有的拉请求，只需将另一个提交添加到拉请求中，审查者只需审查那个额外的提交。这就是为什么 Git 会在评审过程中为您节省大量的时间和精力，从而使团队更有效率。

### 3.Git 允许评审者合并

![](img/73e519da5a45a3c363465015b224c25c.png)

When the reviewer approves the changes made to the code, those changes can be merged to the main line, usually the dev branch. In the Git world, you merge the pull request, while in the world of TFVC, you merge the shelveset. Although both processes seem very similar, there is a crucial difference:

在 TFVC，审阅者将审阅请求标记为“看起来不错”以批准更改。但这是他们唯一能做的。评审者不能自己将评审请求合并到开发分支。这必须由编码器作为一个单独的步骤来完成。

一旦评审请求被批准，*编码人员*必须签出搁置集，然后将批准的变更提交给开发分支。这意味着，虽然编码者可能已经开始了他们的新任务，但是他们被打断去自己执行额外的步骤。

相比之下，在 Git 中，评审者可以在批准请求后立即合并请求。编码器根本不需要参与合并，除非有任何合并冲突，这是一个例外而不是规则。

如果你想象一个有经验的程序员可能每天产生几个拉请求，那么简化的 Git 流程会使团队比 TFVC 的工作流程更有效率。

Git 为编码人员节省了一个不必要的步骤，因此使得开发工作流程更加简单。

### 4.Git 避免了大量的审查/拉取请求

假设您正在开发一个简单的特性，并且正在扩展一个现有类的功能。这是一项简单的任务；你只需要给现有的类添加一个新的方法，然后你就完成了。

然而，这个额外的方法给那个类增加了新的职责。因此，您决定重命名该类，以便其他开发人员更容易理解该类的功能。

当然，您可以使用集成开发环境(IDE)的工具(如 Visual Studio)来重命名该类。因此，这很容易，在代码中使用该类的任何地方都会自动执行重命名。

但是，由于代码中的许多不同位置都使用了该类，所以最终会有 20 个代码文件发生变化。但是只有一个包含了需要回顾的重要逻辑。

如果您在使用 TFVC 时有这样的场景，那么您创建一个审阅请求，它包含一个搁置集中的所有更改。这意味着审阅者被迫以相同的细节审阅所有文件，因为他们不知道应该关注哪里。这是没有必要的，浪费了很多时间。

相反，在 Git 中，你从一个新的特性分支开始。然后，您实现新方法并提交这些更改。之后，在最终创建拉请求之前，重命名该类并再次提交。

当评审者开始评审时，他们将在拉请求中看到两个不同的提交。这产生了两个主要的好处。

首先，通过单独审查提交，审查者可以很容易地遵循开发人员创建特性所采取的步骤。

例如，如果拉请求真的很大，假设它包含 10 个提交和 30 个更改的文件，那么评审者可以一个接一个地检查每个提交，以跟上开发人员的思路。这当然比一个接一个地查看 30 个更改过的文件，而不知道不同文件中的哪些更改属于同一个文件要容易得多。

第二，评审者也可以很容易地找出哪个提交对于评审来说是重要的。

例如，如果提交消息说，“将类 X 重命名为 Y”，并且包含 20 个修改过的文件，那么评审者可以安全地假设 IDE 工具已经正确地完成了重命名，并且他们不需要在那里集中评审。

这意味着可以更容易地审查拆分为单独提交的拉请求。这是因为评审者还可以通过按时间顺序查看每个提交来遵循开发人员的逻辑步骤。它们还可以过滤掉由 IDE 工具触发的更改。

Git 中的 pull 请求可以由多个提交组成，这是我的列表中最大的好处。它只是使整个代码审查任务更加有效，并为审查者节省了大量时间。

在 TFVC，缺乏对大型审查请求的多重提交的支持是一个主要的缺点。由于评审者不得不一遍又一遍地评审同一段代码，他们不再关注细节，可能会漏掉一个 bug。这就是为什么连代码质量都下降了。

这是你应该从 TFVC 转到 Git 的最重要的原因。

## 从 TFVC 到吉特

![](img/e2ffd4daa667106cbda5de1ffc2956ba.png)

The good news is that, from a technical perspective, the move from TFVC to Git is quite easy. The bad news, however, is that you need to have your team on board with that decision, but people generally don’t like change very much.

我已经在一篇单独的博客文章中介绍了技术过程，所以让我们在这里把重点放在迁移的人的方面。

正如我前面提到的，我目前在一个使用 TFVC 的团队中工作。这是由于历史原因，因为主要的编码项目是在大约 10 年前开始的——当时 TFS 还不支持 Git。

由于我的团队中没有人曾经在以前的工作中使用过 Git，他们从来没有习惯在使用 Git 后使用 TFVC。这就是为什么我认为人们看不到 TFVC 和 Git 之间的这些“微小”差异。

然而，我很幸运，我在以前的工作中与 Git 一起工作过，因此我*确实*看到了这些“微小”的差异。

因此，我目前正在帮助我的团队从 TFVC 迁移到 Git。对于此次迁移，我们采用了以下五个步骤，您也可以在自己的迁移过程中遵循:

### 步骤 1:让人们参与迁移

您团队中的成员应该尽早参与整个迁移过程。如果你在没有你的团队的情况下计划和执行所有的任务，然后最后只是把结果丢给他们，很可能你会得到负面的回应。

有很好的[石头汤](https://en.wikipedia.org/wiki/Stone_Soup)的故事，或[煮青蛙](https://en.wikipedia.org/wiki/Boiling_frog)的故事，这基本上解释了为什么你应该在水仍然舒适的时候让你的团队参与进来，因为每个团队成员都可以为改变做出自己的贡献。

出于测试目的进行迁移，并让您的团队成员访问 Git 存储库(repo)进行测试和审查。虽然您仍在使用 TFVC，但您已经可以创建 Git repo 并迁移您的代码，因此每个人都可以看到新的 repo 是什么样子，并对其进行试验。

### 步骤 2:主持一个介绍 Git 特性的研讨会

您团队中的一些人可能以前没有使用过 Git。举办研讨会并向他们展示如何使用 Git 最重要的特性是一个很好的主意。这将清楚地表明开发人员在日常工作中为了使用 Git 需要了解什么。

形象化 git 概念的一个很好的工具是 http://git-school.github.io/visualizing-git/。
有了这个工具，你可以很容易地解释提交是如何总是链接到父节点的。您还可以展示一个分支只是一个指向特定提交的指针，等等。

你不能指望每个人都花时间自学 Git。每个人都有许多其他工作要做，不会找到时间，所以你应该计划一个专门的时间来积极地在团队中获取知识。

### 第三步:分发 Git 备忘单

因为有一些命令很难记住，特别是如果您正在从头开始学习 Git，所以分发一份开发人员在日常工作中需要使用的 Git 命令列表是一个好主意。这样，您的队友可以很容易地查找重要的 Git 指令。

### 步骤 4:设定迁移日期

研讨会结束后，您团队中的每个人都应该有一些关于 Git 的基本知识。但是在您的生产报告中真正从 TFVC 转换到 Git 之前，您应该给他们一些时间将他们的知识应用到迁移的测试存储库中。

两周的时间应该足够了，这样人们可以在测试回购中玩耍，并在不清楚的情况下提问。征求他们的反馈；也许你错过了教他们一些关键的部分。

### 第五步:当每个人都感到自信时，转而使用 Git

![](img/cd947d69088345a168de74a425f7d1e8.png)

A couple of days before the migration date, bring your key people of the team together for a last session. In that session, you can discuss whether they foresee any blocking issues for the go-live. Then you can decide whether you have a “go” or “no go” for the migration.

如果您决定“开始”,那么您就有了迁移的关键人员。如果一切按计划进行，您将在几天后切换到 Git。在那之后，你将会享受到最好的版本控制系统的新力量。

## 迁移到 Git:没有看起来那么难

从 TFVC 到 Git 的迁移没有您想象的那么困难。实际上，我对它的简单明了感到惊讶。只需在控制台中运行几个命令，就可以将 TFVC 存储库迁移到 Git 存储库。

新的 Git repo 将在同一个 TFS 团队项目中。因此，您可以保留所有相关的功能，比如您的用户故事或构建。

例如，你不需要对你的用户故事做任何事情，因为它们在同一个 TFS 团队项目中。当然，为了使用新的 Git repo，您需要稍微修改一下您的构建，但是您在 TFS 的配置的主要部分保持不变。

出于测试目的，您可以同时并行运行 TFVC 回购和 Git 回购。当您确信团队拥有使用 Git 的知识时，您只需通过删除一些权限来锁定 TFVC 存储库，并在迁移后的 Git 存储库上继续开发。

正如您所看到的，从 TFVC 迁移到 Git 有一些主要的好处。最重要的一点是，您可以对一个拉请求进行多次提交，这使得整个审查过程更加容易和有效。您将获得的只是更高的代码质量。

您还可以更容易地一起处理一个特性，并且只有当该特性被成功地测试、评审和构建时，才合并到主分支。

如果你已经经历了从 TFVC 迁移到 Git 的过程，请在评论中分享你的经历。我很想知道你的转变有多困难或顺利。

好的，如果你的团队还在使用 TFVC，我希望我能够说服你改用 Git。希望在几周内，您和您的团队可以享受到市场上最强大的源代码控制系统的好处。

敬请期待！