# 测试驱动开发之我见

> 原文：<https://simpleprogrammer.com/views-test-driven-development/>

我曾经是 TDD 的大力支持者，但是最近，我变得更加务实了。在这个视频中，我讨论了测试驱动开发以及我目前对它的看法。

[//www.youtube.com/embed/wryn6vFwqn8?not_used=1](//www.youtube.com/embed/wryn6vFwqn8?not_used=1)

Full transcript:

约翰:嘿，来自 simpleprogrammer.com T2 的约翰·桑梅兹。这个星期，我想谈谈，是的，一个技术性的话题。我将谈论测试驱动开发。我对测试驱动开发有一些有争议的观点，但是我会解释为什么我持有这些观点。希望我至少能在某种程度上让你相信我说的有一定的道理。

我曾经是测试驱动开发的忠实支持者。当几乎没有人做单元测试的时候，我曾经非常努力地推动它。毫无疑问，没有多少人做测试驱动开发。我会经常进入一个组织或者加入一个团队，并且我真的会推动测试驱动开发和单元测试。这是一件好事。通过推动测试驱动开发和单元测试，我最终提高了很多代码的质量，但我对这一点有点太严格了。我有大约 95%的代码覆盖率需求，要求测试覆盖 95%的产品代码。

显然，我对测试驱动开发的看法已经改变，否则我不会告诉你这些。他们没有很大程度的改变。他们变得更加务实了。至少我是这么认为的。首先，让我解释一下，为什么我认为测试驱动开发是好的，特别是如果你根本不做任何类型的单元测试，我会鼓励你做一些测试驱动开发。这是因为我发现做测试驱动开发对我来说最大的好处是它能帮助你更好地写好代码。

这是因为当你首先编写测试时，它迫使你使用代码的 API。它迫使你使用产品代码，从而影响你使代码的结构更易于使用，更易于理解。当我们只是先写一堆代码，而你没有考虑它将如何被使用时，我们是在猜测人们将如何使用它，或者它将有多容易被使用。当你首先编写单元测试，然后编写代码使这些单元测试通过时，你基本上是从定义 API 开始的，这对于编写易于理解的高质量清晰代码是非常有价值的。

这对我来说真的是很大的好处。当然，也有倒退。你可以运行那些单元测试，但是我倾向于认为只要单元测试进行下去，回归就不再那么重要了。别误会我的意思。你仍然有更高层次的自动化测试，但是就单元测试而言，那些回归测试真的证明不了什么。我发现，在大多数复杂的软件系统中，当你的单元测试失败时，我们不得不去试着调试它，找出为什么这个单元测试失败，而且大多数时候它是一个错误的警报。

我要说的是，单元测试失败的时候，我会说，“哦，这是一个 bug。”更多的时候，我会说，“这个测试真的正确吗？”或者，“哦，是啊，是啊。这是意料之中的，”或者，“这次模拟失败了。”这是不好的一面。

让我告诉你我现在的想法。我认为现在测试驱动就像是编写好代码的辅助轮。它应该在某些情况下使用，但不是一直使用。

很多时候，我们最终只是简单地强迫测试驱动开发。我们最终得到的是一个传递了大量模仿或依赖的代码。我们可能会使用控制反转或依赖反转容器来尝试将各种依赖传递到我们的代码中，然后当我们进行测试驱动开发时，我们将在单元测试中模拟它。这是一条糟糕的道路，因为那些测试变得比实际代码更难编写，我们编写的测试代码最终容易出错，我们可能在测试代码中有 bug。谁来测试测试代码？我们要写测试来测试测试代码吗？不，我们不会那么做的。

我认为务实一点很有意义。如果你刚刚开始写代码，你肯定应该对你所有的代码进行测试驱动开发，因为你需要学习如何写一个好的代码。当我开始做测试驱动开发时，它真的教会了我如何编写好的代码，如何编写好的 API 并真正提高我代码的质量。

如果你已经写了一段时间的代码，如果你一直在做测试驱动的开发，你可能会发现你开始觉得这些测试没有增加价值。当你觉得测试没有增加价值时，这是我个人的信念，停止写那些测试。你希望能够用你的测试驱动开发来测试代码，或者当你正在编写一个单元测试时，它能给你带来一些价值。如果你觉得它没有创造价值，停止做它，因为它很可能没有创造价值。您可以重构您的代码，并以一种更容易编写单元测试的方式来组织您的代码。

我在我的博客上写道……代码只有两种角色。如果你搜索 2 个角色的代码，你会找到我的帖子。基本上，我说有算法，然后有一个代码把一切联系在一起。如果你能更好地将你的代码分成这两种类型，并且不在类中混合在一起，那么你可以写单元测试或者你可以在算法部分做测试驱动的开发，并且没有很多依赖，不需要使用很多模拟。这些测试将会非常有价值，而且会对你非常有益。

如果你把所有的东西都混合在一起，并且你发现你不得不写很多模拟，你发现你的测试代码真的很复杂，那么你可能真的想质疑在这种情况下进行测试驱动开发的价值。

总的来说，在我看来，我认为测试驱动开发是好的。对初学者来说真的真的很好。如果你刚开始，你需要开始练习，以便更好地发展。随着你获得更多的经验，你必须运用你的常识。对此你必须务实。如果你觉得测试没有增加价值或者只是在浪费时间，那么这可能是真的。

好吧，我希望这个视频没有让你太生气。与我职业生涯早期相比，我对测试驱动开发肯定有不同的看法。就像我说的，这来自我的经验。如果你不同意我，让我知道。请在下面给我留言或给我发电子邮件。别忘了订阅这个频道，我希望你有一个美好的一周，下次我会再和你聊天。回头见。