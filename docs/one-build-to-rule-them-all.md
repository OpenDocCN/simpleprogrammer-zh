# 一个软件构建来管理它们

> 原文：<https://simpleprogrammer.com/one-build-to-rule-them-all/>

昨晚我花了很长时间解决了一个“在我的机器上工作”的问题。

学习一件事需要付出痛苦；这种痛苦也许是好的。这让我想起了一个在软件开发基础设施中非常重要的概念。

我有三条开发环境和部署的黄金法则:

1.  我应该能够在本地运行一个与将在持续集成服务器上运行的构建完全相同的软件构建。
2.  仅部署由持续集成服务器构建的位，并且相同的位被部署到每个环境。
3.  环境中的配置差异只存在于一个地方和那台机器上。

你不必遵循这些规则，但如果你不这样做，很可能你会在某个时候经历一些痛苦。

如果您正在构建一个新的部署系统，或者您正在改造一个旧的系统，记住这 3 条规则可以让您在以后的工作中省去很多麻烦。



![software build](img/68dd54fc6e942fd0a8dd04027f538301.png "lotr")



我认为值得谈论每一个规则以及为什么我认为它很重要。

## 规则 1:本地构建=构建服务器构建

如果您希望您的[持续集成](https://simpleprogrammer.com/2009/12/30/continuous-integration-best-practices/)环境成功，它需要适当地报告失败和成功。

如果您的构建服务器报告错误的失败，没有人会相信构建服务器，并且您将排除与构建配置相关的问题，而不是实际的软件问题。解决这类问题绝对没有商业价值。它只是一个时间槽。

如果您在将代码部署到另一个环境时报告了错误的成功，您将会发现问题，将会浪费时间来部署损坏的代码，并且您将会有一个很长的反馈循环来修复它。

作为一名开发人员，当我签入我的代码时，我应该能够运行构建服务器将运行的完全相同的命令。我甚至建议建立一个您公司正在使用的持续集成服务器的本地版本。

如果在本地运行时，软件构建不会在构建服务器上失败，或者在部署过程中不会失败，那么您就可以避免对错误的构建失败进行故障排除。(部署仍然可能失败，应用程序仍然可能在不同的环境中表现出不同的行为，但是至少您将知道您正在使用完全相同的过程构建完全相同的位。)

## 规则 2:软件构建服务器位=仅部署的位

构建一次，然后将这些部分部署到任何地方。为什么？

因为多次构建完全相同的位是浪费时间。

因为确保将完全相同的代码部署到每个环境(开发、测试、试运行、生产等)的唯一方法。)，是为了确保在每个环境中部署完全相同的位。

完全相同的 SVN 数是不够的，因为应用程序不仅仅是源代码。你可以在两台不同的机器上构建完全相同的源代码，然后得到完全不同的应用程序。不，我没有疯。这是一个真实的陈述。机器上不同的库可以产生不同的二进制文件。不同的编译器会产生不同的二进制文件。

不要冒险。如果您想确保您在 QA 中测试的代码在生产中以完全相同的方式工作，请确保它是完全相同的代码。

这意味着您不能将您的配置打包到部署包中。是的，我知道你总是这样做。是的，我知道找出另一种方法很痛苦，但它将为您节省时间，因为您再也不必质疑部署的细节，这是值得的。

## 规则 3:环境配置驻留在环境中

遵守这条规则将会为你省去大量的悲伤。

想想吧。

如果每个环境中唯一不同的是在该环境中的一个位置、一个文件中，那么区分不同之处有多容易？

我知道有很多奇特的方案可以根据部署的环境向部署包中添加配置。我自己已经写了至少 3 个这样的系统。

但是，它们总是在某个地方失败，你花几个小时跟踪它们，找出哪里出错了，并问自己“这到底是怎么回事？”

通过将环境的配置放在环境中的一个地方，您就承担了远离软件构建过程的管理配置的责任，并将它放在一个已知的地方。