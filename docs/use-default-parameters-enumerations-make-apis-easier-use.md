# 使 API 更易于使用和理解

> 原文：<https://simpleprogrammer.com/use-default-parameters-enumerations-make-apis-easier-use/>

有多少次你试图使用一个 API，却发现你必须用你不知道的值来填充一些荒谬的参数？

如果你曾经做过 Windows 编程，并且不得不调用一些 Win32 APIs，我敢肯定你经历过这种痛苦。我需要这个参数吗？这个值到底有什么用？

即使您没有编写外部 API，在不指定大量参数的情况下尽可能容易地使用 API 也是很有意义的，并且尽可能限制这些参数的选项也是一个好主意。

在这篇文章中，我将向你展示三种方法，你可以把一个复杂的 API 变得更加简单易用。

## 我们的攻击性 API 方法

让我们从一个需要清理的 API 方法开始。(例子在 C#中，但是这个想法适用于许多语言。)



![Man looking taken aback and affronted](img/69ab331c88126a51082087d10b8d210c.png)



当然，这个方法签名看起来并不坏，但是它并不是最容易使用的。你必须填写 4 个不同的参数，你必须知道 *customerType* 是什么，并且必须决定 *numberOfTries* 的值以及它的含义。

在整个代码库中看到这样的方法是很常见的。虽然它们看起来很简单，但是它们最终引入了复杂性，因为它们要求调用者做比调用方法所必需的更多的工作，并且理解比他们可能需要知道的更多的系统。

在这种情况下，我故意不解释什么是 *customerType* 或 *numberOfTries* ，因为作为试图使用这段代码的开发人员，你也不会知道。你必须去弄清楚。

让我们看看是否可以稍微改进一下这个方法签名。

## 1.通过创建对象减少参数数量

为了使这个方法签名简单一点，我们可以做的第一件事是减少它的参数数量。

唯一的问题是，我们需要所有这些参数，否则我们不会有它们，对不对？

这可能是真的，那么我们实际上能做什么呢？

好吧，一个真正常见的重构步骤——可能你不会太惊讶——是通过将参数组合成一个对象来减少参数。

[*(顺便说一句，如果你正在寻找一本关于重构的经典而伟大的书，看看马丁·福勒的《重构改善现有代码的设计》)*](http://www.amazon.com/gp/product/0201485672/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0201485672&linkCode=as2&tag=makithecompsi-20&linkId=7QVMVC5S2SV4XOC6)

现在，大多数开发人员都用错误的方式来做这件事。他们右键单击并选择 IDE 中的 refactor 选项，然后将所有参数放入一个单独的类中。

这是错误的，因为它只是隐藏了问题，现在要求代码的调用者首先创建一个对象，该对象有一个接受相同参数的构造函数。如果你这样做，你只是在过河拆桥。

相反，你应该把相关的参数组合在一起，这些参数总是紧挨着的。

在我们的例子中，有意义的参数是*用户名*和*密码*。这些参数一起构成了用户的登录。因此，创建一个包含这两个参数的 *LoginInfo* 类是有意义的。我们甚至会发现这个类有一些自己的附加功能或者包含更多的数据。但是，现在我们可以简单地重构，使这个方法签名更简单。

现在需要更多的代码来调用我们的方法，但是代码被简化了，更容易理解。当有人试图调用该方法，并且发现他们需要一个 *LoginInfo* 对象时，他们可以很容易地看到 *LoginInfo* 对象需要一个*用户名*和*密码*，并且很清楚它的用途是什么。

通过减少一个参数，我们只是稍微降低了复杂性，但是我们使 API 更加有目的和清晰。

## **2。使用枚举来限制选择**

但是我们还没有完成。我们还可以做更多的事情来改进这个简单的 API。

API 的下一个大问题是 *customerType* 参数非常模糊。我们无法立即推断出它的含义以及应该在其中放入什么值。是否有受限的值列表？是自由形式吗？这有关系吗？或者我可以在这里放一个空字符串？

我们可以通过使用枚举限制可能的值来解决这个问题。在这个例子中，我们假设*客户类型*可以是 3 个不同值中的一个。我们要求呼叫者手动键入这些值的字符串表示形式，并且不要出错，但是，我们可以通过将选择限制在有效的范围内来改善体验，并降低错误率。

同样，这是一个相当简单的变化，但却是一个强大的变化，因为它确实降低了呼叫者的复杂性。现在，调用者不必考虑应该在那个字符串参数中为 *customerType* 输入什么，而是可以从三个可能的选项中选择一个。通过进行这一更改，我们还使调用者能够利用 IDE 的自动完成功能来帮助做出选择，并且我们大大降低了因输入错误而出错的可能性，因为我们现在是在编译时而不是运行时验证值。

由于这个原因，任何时候你可以限制方法中参数的选择，你应该。枚举是最简单的方法，但是您也可以利用其他技术。

例如，假设您有一个采用参数 *maximumAge 的方法。*您可以将它设为一个 *int* ，但是，在大多数情况下，创建一个 Age 类会更好，它有自己的验证机制，确保实际年龄是一个介于 0 和 130 之间的整数。您不会在编译时捕获错误，但是您会极大地限制可能的值，并且您会通过其类型的名称使参数的意图更加清楚。

## **3。使用默认值减少所需参数**

在许多情况下，可以为 API 中的方法参数提供合理的默认值。只要有可能，使用缺省值和可选参数来进一步降低复杂性是有意义的，并且只需要 API 的调用者担心什么对他们是重要的。

如果您的 API 主要以一种方式使用，或者有一个合理的缺省值，请提供缺省值并使参数可选。需要额外功能的呼叫者总是可以覆盖默认值。

在我们的例子中，我们可以通过为两者提供一个合理的缺省值来消除指定一个*客户类型*和*数量类型*的需要。

现在，在大多数情况下，调用我们的方法非常简单。我们可以只提供*登录信息*，如果我们需要更多的控制，我们可以覆盖*客户类型*或*条目数量。*

## **这不是火箭科学**

我们在这里做的很简单，但是不要让简单欺骗了你。我们做了一些小的——也可以说是明显的——改变，但是我们大大减轻了这个方法的调用者的精神负担。



![Agile businessman leaping in the air](img/48f9781a4a27d13d58fec3665af2774b.png)



将这些技术应用于整个 API 或代码库，我们会看到更大的累积收益。当您开始限制选择并将相关数据分组到对象而不是原始参数中时，您会在代码中产生协同效应，因为您能够了解更多关于正在传递的数据的信息。

例如，将我们的 *customerType* 更改为枚举使得调用方法更容易，但是这也使得我们在方法内部的逻辑更简单，因为我们不必检查无效值。任何时候，只要我们可以依赖一定范围内的数据，我们就可以简化处理这些数据的逻辑。

如果你觉得这些建议有用…

注册后再也不会错过任何帖子。

我会每周把所有简单的程序员帖子发到你的邮箱里，还会包括一些我没有在网站上发布的额外内容。已经有超过 4000 名开发者订阅了。