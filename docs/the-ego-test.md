# 自我测试——不会失败的测试案例

> 原文：<https://simpleprogrammer.com/the-ego-test/>

你知道你喜欢做的那些测试吗？你知道我的意思，那些测试用例总是给你一个绿条，从来没有失败过？

如果你有糟糕的一天，你觉得没有什么是正确的，你可以“右键单击”运行，你会得到一个漂亮的 100%通过绿色条。重构那些测试正在测试的代码是很容易的，因为你心里清楚，无论你怎么修改代码，那些测试总是会通过的。多棒的感觉啊。这难道不让你觉得自己是世界之王吗？

我喜欢称这些测试为**自我测试**，因为它们相当于代码奉承。自我测试总是验证你。它告诉你你的代码很漂亮，当它真的很肥的时候。自我测试说“你不会做错事。”自我测试表明“一切都会好起来的。”直到你把代码投入生产，一切都崩溃了。然后，当你寻找自我测试时，你意识到他的信息“绿色是好的”仍然在无休止的重复循环中以最大音量播放，就像一个咒语，或者那些自我催眠的磁带之一，“你可以戒烟”。他不是你真正的朋友；他只是一个死循环的录音。他不会帮你解决 bug，甚至不会告诉你它们的存在。

必须阻止他！

**[](https://simpleprogrammer.com/wp-content/uploads/2010/03/39-ego.jpg)**

**![](img/1e7c6c1469ccf926afa2e3b302b64472.png "39-ego")**

**T6】**

## 识别自我测试

自我测试可以是任何类型的测试，从单元测试到自动化功能测试等等。

自我测试可通过以下一个或多个特征来识别:

1.  不包含断言。
2.  包含仅在始终为真的条件下断言的断言，例如: *assertTrue(isJohnSonmezCool？真:真)；*
3.  断言与你测试的内容无关的东西。
4.  捕捉异常并吃掉它们，这样测试就不会出错。
5.  通过模拟测试事物，但不断言模拟的期望得到了满足。
6.  无论对代码做什么，都不会失败。

你可能会认为根据这个清单，停下来做一个自我测试是很容易的。这并不总是那么容易。许多自我测试看起来是在测试正确的事情，或者看起来可能会失败，尽管他们不能。

一个快速确定你是否有自我测试的方法是改变测试的输入，看看它是否失败。如果您认为您正在下拉列表中查找单词“Blue ”,并且您将正在测试的 HTML 更改为下拉列表中不包含单词“Blue ”,并且如果测试仍然通过，那么您就有问题了。

## 避免自我测试

自我测试很容易避免。最好的方法是确保当您更改输入时，您的测试会失败。大多数情况下，您可以通过临时更改源代码来产生一个应该失败的结果。虽然有时你没有能力改变源代码，或者这样做将会是多余的工作。在这些情况下，您可以改为更改测试，以测试不应该为真的条件。但是在这里要非常小心，许多人在尝试用第二种方法验证测试时被绊倒了，因为他们只是颠倒了一个断言语句。

例如，如果您有一个为

并且您试图通过反转断言来验证测试并不总是通过

好吧，那真是太傻了。但是我以前见过。当然，它现在会失败。
*有效的是将断言改为如下形式:*

*查看[要点](https://gist.github.com/simpleprogrammer-shared/391994ae4665377874755ab8fd2f0a6b)上的代码。*

*当你知道“绿色”不应该出现在下拉菜单中。如果在这种情况下测试仍然通过，则 dropDownContains 方法有问题，或者您对正在测试的数据内容所做的一些其他假设有问题。也许你测试了错误的下拉控件？也许是别的什么地方出了问题。*

*避免自我测试的另一个建议是:知道你在测试什么，并且只测试一件事。如果您正在编写一些代码来增加您的代码覆盖率，并且您可以为测试提供的最佳名称是方法本身的名称，后跟单词“test”，那么您不知道您实际测试的是什么。当你实际上不测试任何东西时，在单元测试中获得 100%的代码覆盖率是相当容易的。*

***突变测试***

*对了，这种检测的正式名称叫做[突变检测](http://en.wikipedia.org/wiki/Mutation_testing)。我不确定是否完全有必要对你的测试进行全面的突变测试，如果你真的遵循了我给出的建议来避免自我测试的话，但是确实有一些非常酷的突变测试工具。我知道的一个 Java 叫做 [Jester](http://jester.sourceforge.net/) 。它会随机改变你的源代码并运行你所有的单元测试。Jester 然后报告在更改源代码后哪些测试仍然通过了。看起来 C#有一个叫做 [Nester](http://nester.sourceforge.net/) 的。如果你知道任何一种语言的好的更新版本，一定要让我知道。*

****免责声明:本帖不适用于查克·诺里斯。Chuck Norris 的测试看起来像自我测试，因为它们从不失败，但它们不会失败是因为代码实际上改变了，以符合 Chuck Norris 在他的测试中指出的完美意愿，而不是因为他的测试没有测试正确的东西。*T3】***