# 以创纪录的速度掌握新的代码库

> 原文:[https://simple programmer . com/master-new-code base-record-time/](https://simpleprogrammer.com/master-new-codebase-record-time/)

你加入了一个新团队。您项目的代码库非常庞大。你不知道从哪里开始。你不想看起来很傻，你的队友都在忙自己的工作。不管你的经验水平如何，你如何快速地在一个新的代码库中变得高效？

我们都经历过。带着未知的代码库投入到新的、现有的项目中是经常发生的事情。无论是因为你开始了一份新工作，还是刚刚在同一家公司换了团队，挑战都是一样的:学习代码，开始工作，不要破坏东西。

你是怎么做到的？

加入一个新项目时，你需要学习的最明显的东西就是代码。你需要弄清楚有哪些类，这些类做什么，不同特性和功能的核心逻辑在哪里，等等。

可惜的是，代码并不是 [*所有的*都需要学习](https://simpleprogrammer.com/2017/06/21/9-common-problems-new-programmers-face/)。随着你获得更多的开发经验，你会了解到你的工作中除了软件之外还有很多*的东西，除了代码之外还有很多*软件*的东西。*

*代码捕捉隐含的假设，并对关于产品服务领域的知识进行编码，以及它将如何运行和如何编写。你的工作是学习和理解所有这些。*

*你需要建立一个产品的心理模型。要做到这一点，你需要了解很多关于它的事情，其中一些并不是显而易见的。*

*了解心智模型所需的所有信息的最佳方式是向一个或多个在代码库方面有丰富经验的开发人员学习。然而，这并不总是可能的，不管是因为没有，还是因为他们太忙了。*

*所以，这里有一些你自己学习代码库的方法。*

## *产品的背景是什么？*

*首先，你需要了解产品或服务的背景。*

*上下文是软件相对于用户和其他产品或服务的位置。它给了你地形。了解上下文可以让你对你的项目和它使用的所有外部服务有所了解。*

*有些服务是严格意义上的 API 服务，最终用户根本不使用。其他的，比如移动应用，直接由终端用户使用。在这两种情况下，产品经常使用第三方服务来提供它们的一些功能。*

*要自己确定项目的上下文，您需要查看产品使用什么库——它的依赖项。如何找到依赖关系将取决于语言和构建工具。因为每种语言和构建工具都有自己处理依赖关系的方式，所以理解项目用于构建产品的工具链是很重要的。*

*为了理解工具链，您需要弄清楚如何构建和运行产品。希望有一些描述构建过程的文档。*

*一些项目，如 Ruby on Rails (RoR)，是基于约定的，这意味着，实际上，所有 RoR 项目都遵循相同的设计、文件布局和基本工具链。结果是，让一个基于约定的项目运行起来变得更加容易，即使您以前没有这方面的经验。*

*如果这个项目是一个更基于配置的项目，就像许多 Java 项目一样，这个任务会变得有点棘手。许多 Java 项目使用 Apache 的 Maven，但是如果它是旧的，它可以使用 Ant 如果它是新的，它可以使用 Gradle。你需要四处挖掘才能找到答案。*

*我所知道的每个构建工具都使用特定的文件来存储它们的任务，使用其他特定的文件来存储项目的依赖项。这些是我的第一站。*

*我喜欢在顶层目录中查找任何我知道是构建文件的文件，比如使用 npm 的项目的 package.json 或基于 Ant 的项目的 build.xml。如果我看不到这些文件，我会查找我不认识或不认识的文件。然后我会谷歌这些文件，看看会出现什么。十有八九，这将我引向构建工具。*

*一旦您弄清楚使用了什么构建工具，您通常可以使用该工具的命令行选项来查看所有可用的任务。搜索信息，或者使用[手册页](https://en.wikipedia.org/wiki/Man_page)，通常是找到哪个选项将返回可用任务的最简单方法。例如，Rake 会用-T 选项显示所有可用的任务。*

*理想情况下，任务的命名应该合理，以表明哪一个最适合构建和运行代码。如果没有，运行每一个看看会发生什么是你的下一个工作。*

*现在，假设您已经能够构建和运行代码，那么您应该尝试使用它(如果它是一个您可以直接与之交互的产品)。试着像一个只想弄清楚它做什么和如何工作的孩子一样使用它。或者把你自己放在用户的头脑中，看看他们如何导航产品来执行他们的各种任务。这些行为让你对产品的作用和人们如何使用它有一个大致的了解。*

*我也喜欢在这个时候运行测试套件，如果有的话。首先，当一切都过去时，它给我温暖和模糊。第二，如果测试失败，它给我提供了一个深入代码和测试以了解更多信息的机会。第三，运行该套件可以让我大致了解测试了多少代码以及用什么方式测试，即单元测试、功能测试、集成测试和/或验收测试。*

*在摆弄完运行的产品之后，是时候弄清楚上下文的其余部分了。*

*我这里的主要方法是查看代码的依赖关系。这些是用于构建和运行项目的库。*

*我喜欢浏览依赖文件，确保我理解每个文件的作用。这种查看依赖项列表的行为有助于识别代码利用的第三方服务或产品，而且还可以识别产品的一些可能的特性或功能。*

*在最近的一份工作中，我接手了两个 Rails 应用程序的开发。他们都完成了大约 80 %,之前的开发人员已经离开了公司，所以我必须自己解决大部分问题。Rails 应用程序使用一个 Gemfile 来捕获它们的依赖关系，所以我知道我需要通过它来弄清楚应用程序使用的是什么东西。*

*浏览宝石档案，我查找了每一个我不熟悉的宝石，我发现了一些有趣的事情。每个应用程序都使用特定的 gem(device)来处理身份验证，两个应用程序都使用 PostgreSQL 而不是 MySQL，一个应用程序使用 Stripe，该应用程序还提供一些 OAuth 功能。此外，每个应用程序都有一个 AWS gem，这意味着它们利用 AWS 来实现部分功能。事实证明，两者都部署并托管在 AWS 的 OpsWorks 平台上。*

*在两个新项目中进行这一过程的结果是，我更加了解了每个应用程序提供的功能，以及它们与之通信的一些外部系统。*

## *产品的架构和设计是什么？*

*![](img/f1fa0a8c93427883f754f953060caf7e.png)*

*术语体系结构和设计经常互换使用。虽然有联系，但这其实是两个不同的概念。架构是系统的高层视图，而设计是较低的类级视图。*

*项目的架构由项目的多个“视图”组成，并捕获非功能性需求或质量属性，如安全性、性能、可修改性、可测试性、可维护性、模块化、弹性、可用性，甚至上市时间。*

*相反，设计是你看到设计模式开始出现的地方。在这一层，您要弄清楚不同的类是如何相互连接和通信的。*

*让我们仔细看看如何使用这两个概念来帮助您掌握新的代码库。*

### *揭露建筑*

*架构让你在更大的尺度上对产品的总体布局有一个很好的概念。您可以通过查看编译时(模块)视图、运行时(组件和连接器)视图和部署(分配)视图来拼凑架构。这些视图中的每一个都捕获了系统的不同质量，它们一起形成了产品的更完整的图片。*

*编译时视图是大多数开发人员认为的架构。它类似于[统一建模语言](https://en.wikipedia.org/wiki/Unified_Modeling_Language) (UML)类图，显示了在编写或阅读代码时应该如何组织代码。它将责任分成模块；每个模块由多个类组成。*

*运行时视图显示了在运行时如何理解系统的各个部分。它将运行时交互分组为组件，并详细描述了这些组件如何与连接器进行交互。这些组件*可以*展示产品如何使用进程和线程，但不限于此。*

*部署视图显示了产品在服务器(或客户端设备)上的物理位置，以及这些服务器之间的关系。它详细描述了软件运行的物理环境。*

*仅仅通过查看代码很难发现架构。如果您足够幸运，正在开发一个使用约定胜于配置的产品，比如 Rails，那么很多工作已经为您完成了，因为它们遵循相同的基本架构。*

*如果你正在进行一个基于配置的项目，你将会有一段更艰难的时间，因为这些项目在架构上没有限制，因此是独一无二的。他们完全受最初开发它的开发人员的影响，并且架构决策背后的推理很少被记录。*

*无论是常规还是配置，大型项目都需要长时间的发展，并且涉及到不同的开发人员，他们可能会也可能不会(更有可能不会)用良好的文档记录项目的架构决策和变更。*

*不幸的是，在现有系统中没有一个架构视图是容易发现的。代码的编译时视图很难被发现的原因是，它是如此高级，以至于低级关系使过程变得复杂。这个视图抽象了系统的类，并显示了整个部分或模块是如何协同工作的。找到这些模块是很困难的，因为虽然类可能在它们内部有一定的组织，但是很少能控制在模块级维护这些边界。*

*随着一个项目的成长和开发人员的来来去去，并不是所有的人都知道架构应该是什么，因此，可能会违背它而没有意识到它。所以最初的架构可能会随着项目的增长而消失。*

*您可以使用包和名称空间中的类组织来让您初步了解项目是如何构建的。使用这种技术，结合我稍后讨论的 UML 类图，您可以更好地了解项目中存在哪些模块。*

*运行时视图稍微容易发现，但是通常不太有用。你可以通过像`ps`这样的操作系统工具和可以显示线程的调试器的组合来发现它。查看在特定线程上运行的类或类组可以帮助您拼凑项目的哪些部分在运行时相互通信。在我参与的大多数项目中，运行时视图只有在有意进行多线程处理时才有帮助。*

*您可以通过查看部署脚本来发现产品的部署视图，比如针对 Rails 的 Capistrano 脚本。如果您知道服务部署在什么系统上，比如 AWS 的 OpsWorks，您还可以从服务的仪表板中拼凑出哪些应用程序运行在哪些服务器上。*

### *发现设计

![](img/e0d5bccf852d065621a49058eb0a15e5.png)* 

*发现产品的设计稍微容易一些，因为类是通过设计构建和关联的。有一些工具可以帮助您揭示项目使用的设计模式，以及这些类如何相互关联和通信。*

*最简单的方法是使用一个工具为整个项目或者部分项目生成一个 UML 类图。如果你不熟悉类图，它们显示了类(很自然，对吗？)以及这些类是如何相关的，例如继承、合成。像 Eclipse、IntelliJ 或 Visual Studio 这样的 ide 可以生成 UML 类图或支持插件。也有独立的工具。你可以在这里找到一个大名单[。](https://modeling-languages.com/uml-tools)*

*您也许可以将生成的类图与您发现的任何编译时架构模块结合使用，以验证您的发现。您可以围绕可疑的模块边界生成类图，以查看您的心理模型是否成立。*

*UML 序列图是第二有用的图。它显示了类如何通信以及以什么顺序通信，这有助于确定系统中的数据流。*

*同样，许多 ide 支持直接或通过插件构建序列图。然而，我使用的所有工具都必须运行代码并对其进行概要分析，以便生成图表，这限制了代码路径的有用性，您可以显式地、轻松地自己运行代码路径。*

*如果您使用的是静态类型语言，如 Java 或 C#，Eclipse 或 Visual Studio 等 ide 将向您展示什么调用特定的方法。重复使用这个特性将有助于您理解哪些类相互通信以及如何通信。然后，您可以为您感兴趣的代码部分构建自己的序列图。*

*在过去的一份工作中，我所在的团队使用 Adobe Flex (AS3)，这是一种类似于 Java 的静态类型语言。因为我是新来的，而且这个项目很大，所以我想对相关的类以及它们是如何布局的有一些直观的了解。我发现 [Visual Paradigm](https://www.visual-paradigm.com/) 产品是唯一能够处理 Flex 的产品之一。使用该产品，我为项目的各个部分生成了图表，因为它太大了，无法在整个项目上运行。*

*由此产生的图表有助于通过它们有多少关系来快速看出哪些类可能是重要的。不幸的是，当我试图包含整个项目的更多内容时，这些图变得不那么有用了。大量的关系开始让发现模式变得困难。*

*也就是说，我发现为代码部分构建序列图非常有用。然而，自动生成的序列图并没有像手工创建它们那样有用。通常，我会从与其他系统通信的一段代码开始，并在我的项目和那些外部系统之间建立调用序列。*

*我还为项目中使用线程、其他进程或工作者的部分构建了序列图，事实证明这对于理解应该发生什么非常有价值。*

## *物理布局是什么？*

*学习代码库的第三个组成部分是学习*内容在目录结构中的物理位置。**

*自然地，一些基于惯例的项目，比如 RoR，使得确定地点变得更容易，因为它们都遵循相似的布局。不过，这并不是说你无事可做。你需要看看`lib`目录下有什么，局部视图存储在哪里，除了预期的`assets`、`models`、`controllers`、`views`之外，`app`目录下还有什么目录。*

*对于像 Java 这样对文件及其相关包的物理位置有严格要求的语言，熟悉这种布局将有助于您发现可用的包。*

*对于像 Ruby 这样没有包到文件位置要求的语言，您可以探索所使用的名称空间。我工作过的几乎所有 Ruby 项目仍然使用类似 Java 的名称空间到文件的位置约定。*

*探索包(或名称空间)有望向您展示它们以合理的方式分组，这可能有助于您发现架构级模块。类如何在包中分组，什么包被分组在一起，可以表明它们应该在同一个模块中。*

## *从一个 Bug 或小特性开始*

*![](img/87d513b97a659421563c10c80888889a.png)*

*接触代码，看看您的修改如何改变最终产品，对于巩固您对代码的理解大有帮助。从低优先级、低严重性的错误或特性开始可以帮助你轻松地做出改变。*

*为了适应一个新项目，根据项目的类型，我有一些策略:*

1.  *如果缺陷附带了栈跟踪，我将从项目中栈顶*的类开始(如果错误发生在库中，它可能不是顶部)。**
2.  *如果项目有一个用户界面(UI ),并且我正在处理的 bug 或特性有一个 UI 组件，那么我首先会搜索在我想要更改的 UI 中使用的文字字符串。我可以用它作为交互开始的切入点，并沿着它找到业务逻辑在哪里。*
3.  *如果项目是基于约定的，我将从寻找最有意义的视图、控制器或模型(或者任何可能对缺陷或特性影响最大的设计方面)开始。有意义的只是你能猜到可能涉及到什么类。*
4.  *如果该项目是一个 web 应用程序或服务，我将努力找到可能涉及的 URL 路径，并找到哪个类处理对该路径的请求。*
5.  *如果缺陷或特性不满足任何其他标准，我就开始寻找可能与我想要改变的代码*接近*的代码，这需要一些有教养的(或没教养的)猜测。查看测试也有助于找到您想要的代码。*

*使用这些技术，我几乎总能找到我想要修改的代码部分。然后我可以开始做一些我能看到的小改变，无论是在 UI、测试、日志中，还是简单地打印到标准输出。*

*结合测试，如果存在的话，这些小实验可以帮助你快速找到项目的正确部分。在这个过程中要记住的一件事是*测试你的假设。**

*假设某事是如何或为什么以某种方式完成的，而不质疑和测试这些假设，是打破某事的好方法。我必须不断提醒自己，某些设计选择可能有一个非常好的理由，即使我不喜欢它们或看不到好处。当我挖掘的时候，我必须把我对代码库的新鲜感保持在我的脑海中，这样我就可以把破坏东西的风险降到最低。*

*确保记录下你在项目过程中发现的任何有趣的事情。如果你证明一个假设是错误的，记录下来。您可能不是最后一个做出这种假设的新开发人员。通过记录你的发现，你将帮助下一个开发者加速这个过程。*

## *包装它*

*投入一个新的代码库从来都不容易，但也不一定要势不可挡。使用简单的技术、一套工具和一些实验，你可以快速积累你的知识和对任何项目的理解。*

*当你面对一个新的代码库时，记得遵循以下步骤:*

*   *通过检查构建脚本，发现用于构建项目的工具链和过程。*
*   *如果可能的话，一旦你完成了产品，就试一试它，看看它能做什么。*
*   *查看项目所依赖的库，以确定产品使用和依赖什么服务和系统。*
*   *使用 UML 图生成工具为项目的全部或部分创建类图和序列图。*
*   *当您阅读代码时，手动创建序列图。*
*   *通过查看部署脚本(如 Capistrano)或文档，调查产品是如何在硬件上部署的。*
*   *查看项目如何在文件系统中布局，以及类如何在包或名称空间中分组，以帮助揭示架构。*
*   *使用一个小的特性或者低优先级的 bug 作为一种方式来接触代码，并开始理解代码真正做了什么。记录您发现的任何有趣的东西，这可能有助于未来的开发人员更快地理解项目。*

*像每一项技能一样，这个过程需要实践，并且不是每一项技术都适用于每个开发人员或项目。注意什么对你的某些项目有用，加倍努力去做好它们。这些是有经验的开发人员有机开发的一些元技能，但是通过有目的地学习和提炼它们，您可以加快整个过程。*