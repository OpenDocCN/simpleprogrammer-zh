# 为什么评论很蠢，一个真实的例子

> 原文:[https://simple programmer . com/why-comments-is-blind-a-real-example/](https://simpleprogrammer.com/why-comments-are-stupid-a-real-example/)

似乎没有什么比我[写一篇帖子](https://simpleprogrammer.com/2015/03/16/11-rules-all-programmers-should-live-by/)或做一个 [YouTube 视频](https://www.youtube.com/watch?v=ErW6fEvulAc)更能激起**宗教辩论**的了，这些视频提到大多数时候评论是不必要的，实际上是弊大于利。

当我读到第二版[代码完成](http://www.amazon.com/gp/product/0735619670/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0735619670&linkCode=as2&tag=makithecompsi-20&linkId=XRVP7LFMXGGPFZPK)时，我第一次在这场辩论中转换立场。

在那本书里，Steve McConnell 非常清楚地告诉我，我在代码中加入这么多注释的原因是:

*   我并没有以一种使解释性注释变得多余的方式来命名事物
*   我的方法和函数太大了，因此需要额外的解释

我写代码的方式彻底改变了。

我相信我做得很好，通过写注释来解释我的代码，让下一个开发人员更容易理解它们，我是一个尽职尽责的程序员。

但是，当我开始应用我在 [Code Complete](http://www.amazon.com/gp/product/0735619670/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0735619670&linkCode=as2&tag=makithecompsi-20&linkId=XRVP7LFMXGGPFZPK) 中学到的东西，并开始编写通常比我之前编写的注释更清晰的代码时，我意识到，比起简单地编写注释，我正在为任何继承我的代码的开发人员做一件**更大的好事**。**我让我的代码更加清晰。**

当我看了鲍勃大叔的书[干净代码](http://www.amazon.com/gp/product/0132350882/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0132350882&linkCode=as2&tag=makithecompsi-20&linkId=OE6W2DLW3J5Z2TNZ)后，我的地位进一步加强。

鲍勃大叔不仅说我们应该避免注释，他还说——并展示了——注释是如何在大多数情况下表明代码表达意图失败的。 

Bob 让我意识到我仍然过于依赖注释，我需要进一步改进我的命名，并努力让我的代码在不需要外部帮助的情况下传达它的意图。

## 展示了一个真正的注释删除示例

现在，这是我自己的个人发展——我不期望每个人都有和我一样的经历，或者甚至以同样的方式看待事情——但是，我确实感觉到**每当我提到一般应该避免注释以支持更多的交流代码时，仍然有大量的无知似乎在喷涌而出。**

有一段时间，我感到需要支持我所说的负担。

对我来说，赞美清晰、可沟通的代码的价值是一回事，但对我来说，展示代码有多清晰——或者像鲍勃叔叔说的那样“干净”——远比被大量注释的同样“好”的代码更容易理解和维护是另一回事。

起初，我会编写一些代码示例，向您展示这种情况是如何发生的。

我将编写一些命名不太好且充满注释的代码，然后向您展示我如何重构这些代码以去掉注释并增加清晰度。

但是，根据经验，我知道这是一个陷阱。

太多人会大叫犯规，声称我设置了一个不代表真实世界代码的“稻草人”。

幸运的是，我意识到现在有一个绝佳的机会向我敞开。

## 重构一些真实的代码。NET 框架

自从微软决定开源整个。NET 代码库，我决定选择一个不错的真实代码的真实例子，但可以重构以消除注释，仍然使代码一样清晰——在我看来更清晰。

我决定“挑选”的代码段[位于这里](https://github.com/dotnet/corefx/blob/master/src/System.IO.FileSystem/src/System/IO/PathHelpers.cs)。

我只是抽出了这段代码中的一个方法， *SplitDirectoryFile，*来说明我的观点。

我不知道这个代码是谁写的，我甚至不认为这个代码不好。我只是用它作为一个例子，所以记住这一点。

我选择了一个相当小的方法，这样它就很容易理解并适合这篇博文，但是我的一般方法可以应用于更大的代码样本。

让我们来看看在我重构之前代码是什么样子的:

就像我之前说的，这段代码还不错。

很明显它在做什么。

这些评论甚至有道理。

但是，我们能去掉所有这些注释，让代码更容易理解吗？

先说第一条评论。看起来足够无辜。

> //假定一个经过验证的完整路径

我们有办法用代码来表达吗？

## 用更好的参数名替换注释

如果我们把变量的名字从 path 改成 validatedFullPath 会怎么样？

差别不是很大——几乎微不足道——但是，我们不仅消除了注释，还使调用此方法的人可以从变量名中看出，他们不应该只是传入路径，而是经过验证的完整路径。

同样，这看起来是一个相当小的变化，但是，我相信它使代码更加清晰。

## 一点更大的变化…

继续，我们可以看看下一条评论:

> //忽略尾随斜线

现在，有几种方法可以解决这个问题。

我们可以简单地用一个方法替换注释，所以我们有:

> if(shoulignoretrailingslash(length，rootLength，validatedFullPath)
> 
> 长度

我们还可以创建一个简单的布尔变量来替换注释:

> bool shoulignorretrailingslash = length > root length & & endsindirectoryseperator(validatedFullPath)；
> 
> if(shoulignore trailingslash)
> 
> 长度

另一种可能更好的方法是这样做:

> length = length withouttrailingslash(length，rootLength，validatedFullPath)；

但是，我在这里看到了一个提高代码整体可读性和结构并去掉注释的机会。

这个重构怎么样？

这可能看起来有点过了，但是我认为将这个静态方法变成一个实际的类是很有意义的。

然后，我们可以非常清楚地交流类应该做什么，并利用类的状态来简化代码。

试图干净地删除注释使我对方法本身进行了重构，因为我发现表达意图的最清晰的方式是封装它。

现在，你可能不同意这种特殊的重构——这没关系——但是我相信你仍然可以看到我们如何通过更清楚地表达代码中的意图来轻松地消除注释。

## 现在变得容易了

从这里开始，去掉下一个注释是微不足道的:

> //查找字符串末尾和根之间的枢纽索引

我们所要做的就是把它变成一个方法，确切地说明它的作用。

查看[要点](https://gist.github.com/simpleprogrammer-shared/372ed51cc310d20ead580ac702be5942)上的代码。

同样，我忍不住也改变了一点结构。

我将*目录*和*文件*移动到类的属性中，而不是方法的 out 参数中。

但是，这不如删除注释并用一个在逻辑之上提供抽象的同时说同样事情的方法来替换它重要。

我还提出了在变量中寻找支点的想法，因此我们可以显式地使用该状态，而不是指望提前返回。(甚至没有用评论来解释。)

现在意图更加清晰了。如果我们没有找到一个枢纽，我们只想返回修剪目录。

## 最终重构

这就把我们带到了最后的重构:

我们简单地将目录的修整提取到一个方法中，该方法确切地说明了它的作用。

现在，在我看来，**这段代码更加清晰，然而它却没有任何注释。**

我可以快速查看这段代码，并准确理解它在做什么。

变量和方法的结构和命名以更加精确和清晰的方式传达了在原始代码的注释中传达的内容。

## 比较和对比

看看原始代码和重构后的代码，看看哪一个更容易理解和维护。

具体比较每种情况下的主要工作方法:

是的，我已经改变了代码的结构，使其成为一个类，并且我已经用属性替换了 out 参数，但是我也可以通过去掉注释并用更具表现力的代码和变量名来替换它们，从而达到类似的效果。(虽然，在这个特殊的例子中，我承认 out 参数使事情变得有点困难。)

## 没有注释的代码更容易维护

尽管如此，我认为尝试以一种代码表达意图的方式编写代码，而不是依赖注释，会使您以更好的方式构建代码，从而产生更内聚的类和更好的整体结构。

不管你认为我是否让事情变得更好，有一点你可能会同意，那就是我肯定没有让事情变得更糟。

如果你能从注释重构到没有注释而不失去清晰度，在我看来这是一个净胜利，因为代码得到更新，而注释没有。(至少他们经常不会。)

请记住，**这是一个已经很不错的代码**的例子，其中的注释并不是很多余。

我看到的大多数注释代码根本不是这样的。

在代码中，变量已经有了很好的名字，注释讨论的是逻辑做了什么，而不是它是如何做的。

我看到的大多数带注释的代码把注释作为根本不清楚的代码的拐杖。

所以，在某种意义上，我选了一个不好的例子。

我没有精心挑选一些带有糟糕注释的糟糕代码，并通过删除它们来使其变得更好——那会很容易。

无论如何，我等待着愤怒的评论员的连珠炮(没有双关语。)

你怎么看？

我说服你了吗？

你至少能明白为什么编写不带注释的代码不是懒惰，而是有益的——或者至少是一种品味问题？

这里有一个并不愚蠢的做法:推销自己。你的成功不仅仅取决于你的技术技能——在我的课程中了解更多信息[“如何作为软件开发人员推销自己”](https://simpleprogrammer.com/store/products/how-to-market-yourself/)