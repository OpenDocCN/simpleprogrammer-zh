# BAT 入门:构建真正的 DSL

> 原文:[https://simple programmer . com/get-up-to-bat-building-a-true-DSL/](https://simpleprogrammer.com/getting-up-to-bat-building-a-true-dsl/)

如果您已经用 BAT 实现做到了这一步，那么您终于成功了。

这并不是说您将永远完成扩展您的自动化框架，构建和改进您的 BAT，但是您正处于拥有一个成熟可用的 BAT 框架的时刻，您可以为这一成就感到自豪。

如果你真的想看看兔子洞通向哪里…继续读下去

## 带到 11 楼



![spinal_tap_but_it_goes_to_eleven](img/a8b71453c7c9a26c464edeae352792a8.png "spinal_tap_but_it_goes_to_eleven")



如果您已经为编写 bat 设计了一个良好的自动化框架，那么您很可能已经创建了一种内部领域特定语言(DSL)。

什么是内部 DSL？

基本上，它是用另一种语言构建的一组 API 和规则，作为它们自己的语言。

您可能会有一些类似这样的代码:

你可以看到这段代码看起来真的像一门语言。很难判断这些代码是 C#还是 Java。

这是内部 DSL 的一个很好的例子。

如果我们将 BAT 测试的相同部分作为外部 DSL 编写，它可能看起来像这样:

有了真正的 DSL，我们可以进一步简化，只需要最少的命令集就可以在应用程序中执行我们想要的命令。

## 如何实现 DSL？

有许多工具和技术可以用来创建 DSL。稍后我会谈到其中的一些，但是首先我们需要设计 DSL 本身。

设计 DSL 可能具有挑战性，但是我发现最好的方法是使用类似于我们用来设计自动化框架的方法。

最好是从语法开始，让你的 BAT 最容易写，最清晰。一旦你做到了这一点，你就可以担心实现 DSL 来支持你想出的语法。

您应该专注于为您的 DSL 创建一个有限的词汇表，这样人们就可以很容易地学习并知道他们的选择是什么。

我们对 DSL 的限制越多，DSL 就越容易实现特定的目的。

我们希望给 DSL 用户的选择不多于他们想做的事情所需要的，也不少于他们想做的事情。

这并不总是容易做到的。它经常需要一些仔细的思考和提炼。

您的 DSL 还应该使用您的应用程序的业务领域所熟悉的术语和短语。通过这样做，你可以让理解你的应用程序的人理解用 DSL 写的 bat。

我也总是试图让 BAT DSL 尽可能多地使用简单的英语。

一旦你设计了 DSL，你将需要一种方法来实现它。

我曾经写过关于使用 ANTLR 创建外部 DSL 的文章。我也写了一本关于我推荐学习 ANTLR 的[书的评论。](https://simpleprogrammer.com/2010/04/16/book-review-the-definitive-antlr-reference-building-domain-specific-languages/)

微软也有一个 [DSL SDK 你可以在 VS2010](http://archive.msdn.microsoft.com/vsvmsdk) 中使用，虽然我自己没用过。

实现 DSL 背后的基本思想是，您必须采用为 DSL 设计的某种语法，将其解析为语法树，然后使用该树来生成实际执行操作的代码。

这绝不是一个微不足道的任务，但是使用 ANTLR 这样的工具，比自己尝试完全生成一个解析器和执行引擎要简单得多。

## 何必呢？

为您的 bat 创建 DSL 是完全可选的，但是这样做有一些显著的好处。

我发现的最大的一个问题是，如果你有一个简单的 DSL 可以用来创建 bat，你就更有可能让业务人员编写 bat。一旦你让每个人都使用 bat 来定义行为和需求，交流就变得简单多了。

创建 DSL 的另一个好处是，您可以创建一个运行程序来解释可以在任何机器上运行的 DSL BAT 脚本。通常，要运行用 Java 或 C#创建的 bat，您需要一个 C#或 Java 编译器和一个测试运行程序，等等。通过创建一个 DSL 和一个独立的执行器，你可以很容易地允许任何人运行 BATs，只需要很少的设置或者不需要设置。

用 DSL 编写 bat 也会使编写 bat 和理解它们变得更加容易。一个好的 DSL 可以去掉所有的小语言和 API 的细微差别，这些细微差别并没有真正给你正在工作的特定领域增加信息。一个好的 DSL 能够将信息减少到所需的最少数量，因为它假设上下文是应用程序的业务领域。

您还会发现，当您拥有 DSL 时，您能够更好地将框架从测试中分离出来。许多团队在创建 BAT 框架时面临的一个问题是，有些人在高级 BAT 中编写低级代码。这就产生了一个问题，因为当框架和 BAT 代码是同一种语言时，很难强迫某人使用更高级别的 API。

## 包装它

我的击球系列到此结束。

希望您已经学到了足够的知识，能够实现自己的 BAT 框架，并让 BAT 为您的应用程序运行。

我试图涵盖这里的大部分重要步骤，而不深入细节。

如果您有任何问题，或者对获得更深入的培训或咨询感兴趣，请给我发电子邮件或留下评论。

开始并运行 BAT 框架可能有点困难，但是付出的努力是值得的！