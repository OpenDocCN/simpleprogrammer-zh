# 开始行动:向外扩展

> 原文：<https://simpleprogrammer.com/getting-up-to-bat-scaling-out/>

如果你没有关注，我已经有一段时间没有发表关于这个话题的文章了。过去几周，我在[有点分心](https://simpleprogrammer.com/2011/04/25/the-most-complex-program-of-all-time/)，但是我回来了，准备好了！

当我们最后一次停止时，我们刚刚得到了我们的球棒，作为任何正在处理的新积压工作的验收标准的一部分。这让我们可以真正地说，我们已经成功地实现了 BAT 测试。

不过，你现在还不想太舒服，因为你最有可能面临的下一个障碍是没有足够的时间来执行所有的测试。

## 你想提前考虑一下吗

最糟糕的事情莫过于让一切顺利进行，然后却不能执行整个测试套件，因为你没有提前计划。

您不希望到达对 BAT 套件失去信心的地步，因为您无法在合理的时间内执行所有的测试。

你的测试运行得越频繁，它们就越有价值。

通过减少从系统中发生重大变更到发现变更的周期时间，您可以极大地减少它对您的软件带来的风险，并且减少可能发生代码变更的范围。

简而言之，你越快发现你弄坏了什么东西，你就越有可能在它造成损坏之前修好它，你就越有可能知道是什么东西导致了损坏。



![clarkson_face](img/da4c259b04b4bdd90a69ccae7b13b3db.png "clarkson_face")



## 我们如何减少周期时间？

我们可以采用几种不同的策略，并且可以混合搭配其中一些策略。

**直接并行化**

你能做的最好的和最有效的事情是进行一个给定的测试运行，在多台机器上分割这些测试的执行，并且并行地执行它们。

这种方法会给你带来最大的收益。在尝试任何其他解决方案之前，您真的应该尝试进行一些并行化，因为它将对您的测试的总执行时间产生巨大影响，而不会做出任何牺牲。

您甚至可以通过多种方式混合搭配来实现并行化:

*   使用多台物理机
*   在一台主机上运行多个虚拟机
*   在每个团队成员的机器上安装一个 executor 程序，当机器空闲或进入测试执行模式(可能是在晚上)时执行测试
*   使用基于云计算的平台来执行您的测试
*   在一台机器上运行多个浏览器实例

**数据预加载**

使用这种方法，您可以通过手动点击屏幕来预加载一些测试数据。

这很难解释，所以让我给你举个例子:

假设您有一组测试，这些测试都涉及到创建客户，但是您在系统中创建的每个客户都需要大约 3 分钟的时间来创建，方法是通过点击屏幕将他们输入到系统中。

我们不需要让 500 个测试在 3 分钟内在系统中执行 500 次完全相同的逻辑，只是为了生成将在测试中使用的所有客户数据。

相反，我们可以留下几个测试来执行客户创建功能，我们可以执行一个 SQL 脚本来将所有其他客户数据推入测试数据库，供其他测试使用。

使用这种技术，我们可能能够将每次测试的总执行时间减少 3 分钟，或者 500 次测试减少大约 25 小时。

这可以节省大量时间，而且成本也不高。我们测试的神圣性稍微受到了损害，但是我们在这里冒了一个计算好的风险，因为我们知道我们已经覆盖了我们正在预加载数据的执行区域。

当您注意到系统中的某些事情需要很长时间才能完成时，请考虑这种技术。

**按区域试运行**

使用这种技术，我们可以通过分割测试区域并在不同的时间运行它们，或者响应特定区域的变化，来减少给定周期内的总执行时间。

你必须非常小心这种方法，因为如果你没有正确地做，你可以开始侵蚀你的 BAT 测试提供给你的一些安全性。

我只会在万不得已的情况下才这样做，因为现在虚拟化太容易了，而且硬件非常便宜。

我宁愿做太多的测试也不愿做太少的测试。

**测试随机化**

通过测试随机化，我们将得到我们总的期望执行时间，并除以运行测试的平均时间。然后，我们可以使用要运行的测试数量，在每次运行测试时随机执行测试，并且只运行符合期望执行时间的数量的测试。

这个选择也是我通常不喜欢采取的妥协。

但是，当您仍然没有足够的时间来执行整个测试套件时，与其他技术相结合，它会非常有用。

这里的基本思想是，你每次都要随机运行测试，以填满你必须运行测试的时间。

**测试还原**

这一条看起来相当明显，但是非常有帮助。

我经常会看到团队从自动化开始，试图为一个给定的特性编写太多的 BAT 测试。当然，通过自动化测试，有可能对你的 5 个下拉列表中的每一个可能的值组合进行测试，但是这对你真的有好处吗？

在许多情况下，你必须考虑用你的球棒来保护什么。有时候，运行数据选择的每一种组合是很重要的，但是其他时候，您只需要编写测试来测试一些快乐路径场景。

重要的是在测试覆盖率和测试量之间找到平衡，而不仅仅是执行时间。拥有大量冗余测试会产生逻辑开销。

因此，即使这种技术看起来危险且适得其反，我还是会在某种程度上使用它。

## 常见陷阱

当你扩展和简化你的 bat 执行时，以下是你可能想要注意的一些事情:

*   **并行化问题。如果你使用共享状态，当你的测试并行执行时，你会遇到大麻烦。这有很多表现。您可能在数据库级别或本地计算机内存级别遇到问题。避免这种问题的最好方法是为每个测试执行使用单独的虚拟机，而不是在测试用例之间重用数据设置。**
*   **无效的错误报告。如果你并行运行大量的测试，你最好有一个好的方法来整理结果。当在多台机器上运行时，很难找出失败的原因。**
*   **测试订单依赖性。确保测试不依赖于按一定的顺序运行，否则当你打乱这个顺序时，你会很痛苦。**
*   **环境设置。确保你所有的测试执行环境完全相同，除非你专门测试不同的执行环境。您不希望测试在一台机器上失败，而在另一台机器上通过。**